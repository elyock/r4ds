---
title: "Chapter 3"
author: "Kevin J. Coyle"
format: gfm
editor: visual
---

```{r}
#| label: setup

library(nycflights13)
library(tidyverse)
```

#### 3.2.5 Exercises

1.  In a single pipeline for each condition, find all flights that meet the condition:
    -   Had an arrival delay of two or more hours
    -   Flew to Houston (`IAH` or `HOU`)
    -   Were operated by United, American, or Delta
    -   Departed in summer (July, August, and September)
    -   Arrived more than two hours late, but didn’t leave late
    -   Were delayed by at least an hour, but made up over 30 minutes in flight

```{r}
flights |>
  filter(arr_delay >= 2)
flights |>
  filter(dest %in% c("IAH", "HOU"))
flights |>
  filter(carrier %in% c("UA", "AA", "DL"))
flights |>
  filter(month %in% 7:9)
flights |>
  filter(arr_delay > 120 & dep_delay <= 0)
flights |>
  filter(dep_delay >= 60 & (dep_delay - arr_delay) > 30)
```

2.  Sort `flights` to find the flights with longest departure delays. Find the flights that left earliest in the morning.

This question makes sense to me only if it's asking for two separate sorts.

```{r}
flights |>
  arrange(desc(dep_delay))
flights |>
  arrange(dep_time)
```

3.  Sort `flights` to find the fastest flights.

```{r}
flights |>
  arrange(desc(distance / air_time))
```

4.  Was there a flight on every day of 2013?

```{r}
flights |>
  distinct(month,day) |>
  count()
```

5.  Which flights traveled the farthest distance? Which traveled the least distance?

```{r}
flights |>
  arrange(desc(distance))
flights |>
  arrange(distance)
```

6.  Does it matter what order you used [`filter()`](https://dplyr.tidyverse.org/reference/filter.html) and [`arrange()`](https://dplyr.tidyverse.org/reference/arrange.html) if you’re using both? Why/why not? Think about the results and how much work the functions would have to do.

Use `filter()` first to reduce the amount of data that `arrange()` must sort.

#### 3.3.5 Exercises

1.  Compare `dep_time`, `sched_dep_time`, and `dep_delay`. How would you expect those three numbers to be related?

`dep_time` = `sched_dep_time` + `dep_delay`

2.  Brainstorm as many ways as possible to select `dep_time`, `dep_delay`, `arr_time`, and `arr_delay` from `flights`.

```{r}
flights |> select(dep_time, dep_delay, arr_time, arr_delay)
flights |> select(starts_with(c("dep", "arr")))
flights |> select(ends_with(c("time", "delay")) &
                    !contains(c("sched", "air")))
```

3.  What happens if you specify the name of the same variable multiple times in a [`select()`](https://dplyr.tidyverse.org/reference/select.html) call?

```{r}
flights |> select(arr_time, arr_time)
```

The variable appears only once.

4.  What does the [`any_of()`](https://tidyselect.r-lib.org/reference/all_of.html) function do? Why might it be helpful in conjunction with this vector?

```{r}
variables <- c("year", "month", "day", "dep_delay", "arr_delay")
flights |> select(any_of(variables))
flights |> select(!any_of(variables))
```

`any_of()` would be helpful for selecting or deselecting variables as a group.

5.  Does the result of running the following code surprise you? How do the select helpers deal with upper and lower case by default? How can you change that default?

```{r}
flights |> select(contains("TIME"))
flights |> select(contains("TIME", ignore.case = FALSE))
```

By default, `contains()` is case insensitive. To make it case sensitive, set `ignore.case = FALSE`.

6.  Rename `air_time` to `air_time_min` to indicate units of measurement and move it to the beginning of the data frame.

```{r}
flights |>
  rename(air_time_min = air_time) |>
  relocate(air_time_min)
```

7.  Why doesn’t the following work, and what does the error mean?

```{r}
#| error: true
#| 
flights |> 
  select(tailnum) |> 
  arrange(arr_delay)
```

This doesn't work because the result of the call to `select()` contains only the variable `tailnum`, and not the variable `arr_delay`.
